<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>[Java核心技术] Java并发编程 - ieblYang</title><meta name="Description" content="[Java核心技术] Java并发编程"><meta property="og:title" content="[Java核心技术] Java并发编程" />
<meta property="og:description" content="[Java核心技术] Java并发编程" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieblyang.tech/java11/" /><meta property="og:image" content="https://ieblyang.tech/java11/featured-image.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-22T09:34:40+08:00" />
<meta property="article:modified_time" content="2022-02-22T09:34:40+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieblyang.tech/java11/featured-image.png"/>
<meta name="twitter:title" content="[Java核心技术] Java并发编程"/>
<meta name="twitter:description" content="[Java核心技术] Java并发编程"/>
<meta name="application-name" content="ieblYang">
<meta name="apple-mobile-web-app-title" content="ieblYang"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://ieblyang.tech/java11/" /><link rel="prev" href="https://ieblyang.tech/java10/" /><link rel="next" href="https://ieblyang.tech/basic-markdown-syntax/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.f03a2ec71b16efbe4f24352e542c93a9.css" integrity="md5-8DouxxsW775PJDUuVCyTqQ=="><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[Java核心技术] Java并发编程",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/ieblyang.tech\/java11\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/ieblyang.tech\/java11\/featured-image.png",
                            "width":  1420 ,
                            "height":  708 
                        }],"genre": "posts","keywords": "Java, JavaVolume","wordcount":  15833 ,
        "url": "https:\/\/ieblyang.tech\/java11\/","datePublished": "2022-02-22T09:34:40+08:00","dateModified": "2022-02-22T09:34:40+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "ieblYang","logo": "https:\/\/ieblyang.tech\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "ieblYang"
            },"description": "[Java核心技术] Java并发编程"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="ieblYang"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>ieblYang</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/categories/video/"> 视频 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="ieblYang"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>ieblYang</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/categories/video/" title="">视频</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">[Java核心技术] Java并发编程</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://ieblyang.tech/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>ieblYang</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/java/"><i class="far fa-folder fa-fw"></i>Java</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-02-22">2022-02-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 15833 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 32 分钟&nbsp;<span id="/java11/" class="leancloud_visitors" data-flag-title="[Java核心技术] Java并发编程">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/java11/featured-image.png"
        data-srcset="/java11/featured-image.png, /java11/featured-image.png 1.5x, /java11/featured-image.png 2x"
        data-sizes="auto"
        alt="/java11/featured-image.png"
        title="[Java核心技术] Java并发编程" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-并行计算">1 并行计算</a></li>
    <li><a href="#2-线程组管理">2 线程组管理</a></li>
    <li><a href="#3-java并发框架executor">3 Java并发框架<code>Executor</code></a>
      <ul>
        <li><a href="#31-executor-framework">3.1 <code>Executor FrameWork</code></a></li>
        <li><a href="#32理解共享线程池的概念">3.2理解共享线程池的概念</a></li>
        <li><a href="#主要类executorservice-threadpoolexecutorfuture">主要类：<code>ExecutorService</code>，<code> ThreadPoolExecutor</code>，<code>Future</code></a></li>
      </ul>
    </li>
    <li><a href="#4-java并发框架fork-join">4 Java并发框架<code>Fork-Join</code></a></li>
    <li><a href="#5-java并发数据结构">5 Java并发数据结构</a>
      <ul>
        <li><a href="#51-list">5.1 List</a></li>
        <li><a href="#52-set">5.2 Set</a></li>
        <li><a href="#53-map">5.3 Map</a></li>
        <li><a href="#54-queue--deque-队列jdk-15-提出">5.4 Queue &amp; Deque (队列，JDK 1.5 提出)</a></li>
      </ul>
    </li>
    <li><a href="#6-java并发协作控制">6 Java并发协作控制</a>
      <ul>
        <li><a href="#61-lock">6.1 <code>Lock</code></a></li>
        <li><a href="#62-semaphore">6.2 <code>Semaphore</code></a></li>
        <li><a href="#63-latch">6.3 <code>Latch</code></a></li>
        <li><a href="#64-barrier">6.4 <code>Barrier</code></a></li>
        <li><a href="#65-phaser">6.5 <code>Phaser</code></a></li>
        <li><a href="#66-exchanger">6.6 <code>Exchanger</code></a></li>
      </ul>
    </li>
    <li><a href="#7-java定时任务执行">7 Java定时任务执行</a>
      <ul>
        <li><a href="#71-简单定时器机制">7.1 简单定时器机制</a></li>
        <li><a href="#72-executor-定时器机制">7.2 Executor +定时器机制</a></li>
        <li><a href="#73-quartz">7.3 Quartz</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Java 核心技术读书笔记——Java并发编程</p>
<h2 id="1-并行计算">1 并行计算</h2>
<ul>
<li>业务：任务多，数据量大</li>
<li>串行 vs 并行
<ul>
<li>串行编程简单，并行编程困难</li>
<li>单个计算核频率下降，计算核数增多，整体性能变高</li>
</ul>
</li>
<li>并行困难(任务分配和执行过程<strong>高度耦合</strong>)
<ul>
<li>如何控制粒度，切割任务</li>
<li>如何分配任务给线程，监督线程执行过程</li>
</ul>
</li>
<li>并行模式
<ul>
<li>主从模式 (Master-Slave)</li>
<li><code>Worker</code>模式(Worker-Worker)</li>
</ul>
</li>
<li>Java并发编程
<ul>
<li><code>Thread/Runnable/Thread</code>组管理</li>
<li><code>Executor</code></li>
<li><code>Fork-Join</code>框架</li>
</ul>
</li>
</ul>
<h2 id="2-线程组管理">2 线程组管理</h2>
<p>线程组<code>ThreadGroup</code></p>
<ul>
<li>线程的集合</li>
<li>树形结构，大线程组可以包括小线程组</li>
<li>可以通过<code>enumerate</code>方法遍历组内的线程，执行操作</li>
<li>能够有效管理多个线程，但是<strong>管理效率低</strong></li>
<li>任务分配和执行过程<strong>高度耦合</strong></li>
<li>重复创建线程、关闭线程操作，<strong>无法重用线程</strong></li>
</ul>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><code>activeCount</code> 返回线程组中还处于<code>active</code>的线程数（估计数）；</li>
<li><code>enumerate</code> 将线程组中<code>active</code>的线程拷贝到数组中；</li>
<li><code>interrupt</code> 对线程组中所有的线程发出<code>interrupt</code>信号；</li>
<li><code>list</code> 打印线程组中所有的线程信息。</li>
</ul>
</div>
        </div>
    </div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="c1">// Result.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">threadgroup</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 搜索结果类
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Result</span> <span class="o">{</span>
  
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>  
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span> 
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>
<span class="c1">// Searcher.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">threadgroup</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Searcher</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="nf">Searcher</span><span class="o">(</span><span class="n">Result</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">result</span><span class="o">=</span><span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Thread %s: 启动\n&#34;</span><span class="o">,</span><span class="n">name</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">doTask</span><span class="o">();</span>
      <span class="n">result</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Thread %s: 被中断\n&#34;</span><span class="o">,</span><span class="n">name</span><span class="o">);</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Thread %s: 完成\n&#34;</span><span class="o">,</span><span class="n">name</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">doTask</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">Random</span> <span class="n">random</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">((</span><span class="k">new</span> <span class="n">Date</span><span class="o">()).</span><span class="na">getTime</span><span class="o">());</span>
    <span class="kt">int</span> <span class="n">value</span><span class="o">=(</span><span class="kt">int</span><span class="o">)(</span><span class="n">random</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()*</span><span class="n">100</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Thread %s: %d\n&#34;</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span><span class="n">value</span><span class="o">);</span>
    <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Main.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">threadgroup</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// 创建线程组
</span><span class="c1"></span>    <span class="n">ThreadGroup</span> <span class="n">threadGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadGroup</span><span class="o">(</span><span class="s">&#34;Searcher&#34;</span><span class="o">);</span>
    <span class="n">Result</span> <span class="n">result</span><span class="o">=</span><span class="k">new</span> <span class="n">Result</span><span class="o">();</span>

    <span class="c1">// 创建一个任务，10个线程完成
</span><span class="c1"></span>    <span class="n">Searcher</span> <span class="n">searchTask</span><span class="o">=</span><span class="k">new</span> <span class="n">Searcher</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">Thread</span> <span class="n">thread</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">threadGroup</span><span class="o">,</span> <span class="n">searchTask</span><span class="o">);</span>
      <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========华丽丽0=======&#34;</span><span class="o">);</span>
    
    <span class="c1">// 查看线程组消息
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;active 线程数量: %d\n&#34;</span><span class="o">,</span><span class="n">threadGroup</span><span class="o">.</span><span class="na">activeCount</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;线程组信息明细\n&#34;</span><span class="o">);</span>
    <span class="n">threadGroup</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========华丽丽1=======&#34;</span><span class="o">);</span>

    <span class="c1">// 遍历线程组
</span><span class="c1"></span>    <span class="n">Thread</span><span class="o">[]</span> <span class="n">threads</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">threadGroup</span><span class="o">.</span><span class="na">activeCount</span><span class="o">()];</span>
    <span class="n">threadGroup</span><span class="o">.</span><span class="na">enumerate</span><span class="o">(</span><span class="n">threads</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">threadGroup</span><span class="o">.</span><span class="na">activeCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Thread %s: %s\n&#34;</span><span class="o">,</span><span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">(),</span><span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getState</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========华丽丽2=======&#34;</span><span class="o">);</span>

    <span class="c1">// Wait for the finalization of the Threadds
</span><span class="c1"></span>    <span class="n">waitFinish</span><span class="o">(</span><span class="n">threadGroup</span><span class="o">);</span>
    
    <span class="c1">// Interrupt all the Thread objects assigned to the ThreadGroup
</span><span class="c1"></span>    <span class="n">threadGroup</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">waitFinish</span><span class="o">(</span><span class="n">ThreadGroup</span> <span class="n">threadGroup</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">threadGroup</span><span class="o">.</span><span class="na">activeCount</span><span class="o">()&gt;</span><span class="n">9</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 运行结果：
</span><span class="cm"> * Thread Thread-0: 启动
</span><span class="cm"> * Thread Thread-0: 83
</span><span class="cm"> * Thread Thread-1: 启动
</span><span class="cm"> * Thread Thread-1: 73
</span><span class="cm"> * Thread Thread-2: 启动
</span><span class="cm"> * Thread Thread-2: 1
</span><span class="cm"> * Thread Thread-2: 完成
</span><span class="cm"> * Thread Thread-3: 启动
</span><span class="cm"> * Thread Thread-3: 92
</span><span class="cm"> * Thread Thread-4: 启动
</span><span class="cm"> * Thread Thread-4: 73
</span><span class="cm"> * Thread Thread-5: 启动
</span><span class="cm"> * Thread Thread-5: 64
</span><span class="cm"> * Thread Thread-6: 启动
</span><span class="cm"> * Thread Thread-6: 89
</span><span class="cm"> * Thread Thread-7: 启动
</span><span class="cm"> * Thread Thread-7: 80
</span><span class="cm"> * Thread Thread-8: 启动
</span><span class="cm"> * Thread Thread-8: 8
</span><span class="cm"> * Thread Thread-9: 启动
</span><span class="cm"> * Thread Thread-9: 99
</span><span class="cm"> * ========华丽丽0=======
</span><span class="cm"> * active 线程数量: 9
</span><span class="cm"> * 线程组信息明细
</span><span class="cm"> * java.lang.ThreadGroup[name=Searcher,maxpri=10]
</span><span class="cm"> *     Thread[Thread-0,5,Searcher]
</span><span class="cm"> *     Thread[Thread-1,5,Searcher]
</span><span class="cm"> *     Thread[Thread-3,5,Searcher]
</span><span class="cm"> *     Thread[Thread-4,5,Searcher]
</span><span class="cm"> *     Thread[Thread-5,5,Searcher]
</span><span class="cm"> *     Thread[Thread-6,5,Searcher]
</span><span class="cm"> *     Thread[Thread-7,5,Searcher]
</span><span class="cm"> *     Thread[Thread-8,5,Searcher]
</span><span class="cm"> *     Thread[Thread-9,5,Searcher]
</span><span class="cm"> * ========华丽丽1=======
</span><span class="cm"> * Thread Thread-0: TIMED_WAITING
</span><span class="cm"> * Thread Thread-1: TIMED_WAITING
</span><span class="cm"> * Thread Thread-3: TIMED_WAITING
</span><span class="cm"> * Thread Thread-4: TIMED_WAITING
</span><span class="cm"> * Thread Thread-5: TIMED_WAITING
</span><span class="cm"> * Thread Thread-6: TIMED_WAITING
</span><span class="cm"> * Thread Thread-7: TIMED_WAITING
</span><span class="cm"> * Thread Thread-8: TIMED_WAITING
</span><span class="cm"> * Thread Thread-9: TIMED_WAITING
</span><span class="cm"> * ========华丽丽2=======
</span><span class="cm"> * Thread Thread-7: 被中断
</span><span class="cm"> * Thread Thread-5: 被中断
</span><span class="cm"> * Thread Thread-1: 被中断
</span><span class="cm"> * Thread Thread-9: 被中断
</span><span class="cm"> * Thread Thread-3: 被中断
</span><span class="cm"> * Thread Thread-8: 被中断
</span><span class="cm"> * Thread Thread-0: 被中断
</span><span class="cm"> * Thread Thread-6: 被中断
</span><span class="cm"> * Thread Thread-4: 被中断
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3-java并发框架executor">3 Java并发框架<code>Executor</code></h2>
<h3 id="31-executor-framework">3.1 <code>Executor FrameWork</code></h3>
<p>从 <code>JDK 5</code> 开始提供<code>Executor FrameWork</code> (<code>java.util.concurrent.*</code>)</p>
<ul>
<li>分离任务的创建和执行者的创建</li>
<li>线程重复利用(<strong><code>new</code>线程代价很大</strong>)</li>
</ul>
<h3 id="32理解共享线程池的概念">3.2理解共享线程池的概念</h3>
<ul>
<li>预设好的多个<code>Thread</code>，可弹性增加</li>
<li>多次执行很多很小的任务</li>
<li>任务创建和执行过程解耦</li>
<li><strong>程序员无需关心线程池执行任务过程</strong></li>
</ul>
<h3 id="主要类executorservice-threadpoolexecutorfuture">主要类：<code>ExecutorService</code>，<code> ThreadPoolExecutor</code>，<code>Future</code></h3>
<ul>
<li><code>Executors.newCachedThreadPool/newFixedThreadPool</code> 创建线程池</li>
<li><code>ExecutorService</code> 线程池服务</li>
<li><code>Callable</code> 具体的逻辑对象(线程类)</li>
</ul>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><code>Callable</code> 和<code>Runnable</code>是等价的，可以用来执行一个任务</li>
<li><code>Runnable</code>的<code>run</code>方法没有返回值，而<code>Callable</code>的<code>call</code>方法可以有返回值</li>
</ul>
</div>
        </div>
    </div>
<ul>
<li><code>Future</code> 返回结果</li>
<li>实例1，各方法演示：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="c1">// executor/example1/Server.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">executor.example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadPoolExecutor</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 执行服务器
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>

  <span class="c1">//线程池
</span><span class="c1"></span>  <span class="kd">private</span> <span class="n">ThreadPoolExecutor</span> <span class="n">executor</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Server</span><span class="o">(){</span>
    <span class="c1">// 创建一个默认线程池
</span><span class="c1"></span>    <span class="n">executor</span><span class="o">=(</span><span class="n">ThreadPoolExecutor</span><span class="o">)</span><span class="n">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
    <span class="c1">// 创建一个固定个数的线程池
</span><span class="c1"></span>    <span class="c1">//executor=(ThreadPoolExecutor)Executors.newFixedThreadPool(5);
</span><span class="c1"></span>  <span class="o">}</span>

  <span class="c1">//向线程池提交任务
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">submitTask</span><span class="o">(</span><span class="n">Task</span> <span class="n">task</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Server: A new task has arrived\n&#34;</span><span class="o">);</span>
    <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">task</span><span class="o">);</span> <span class="c1">//执行  无返回值
</span><span class="c1"></span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Server: Pool Size: %d\n&#34;</span><span class="o">,</span><span class="n">executor</span><span class="o">.</span><span class="na">getPoolSize</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Server: Active Count: %d\n&#34;</span><span class="o">,</span><span class="n">executor</span><span class="o">.</span><span class="na">getActiveCount</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Server: Completed Tasks: %d\n&#34;</span><span class="o">,</span><span class="n">executor</span><span class="o">.</span><span class="na">getCompletedTaskCount</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="c1">// 关闭整个线程池 
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">endServer</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// executor/example1/Task.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">executor.example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="cm">/**
</span><span class="cm"> * Task 任务类
</span><span class="cm"> * @author Tom
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Task</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">//休眠，进行两次输出
</span><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Long</span> <span class="n">duration</span><span class="o">=(</span><span class="kt">long</span><span class="o">)(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="n">1000</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s: Task %s: Doing a task during %d seconds\n&#34;</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span><span class="n">name</span><span class="o">,</span><span class="n">duration</span><span class="o">);</span>
      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">duration</span><span class="o">);</span>     
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s: Task %s: Finished on: %s\n&#34;</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span><span class="n">name</span><span class="o">,</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
  <span class="o">}</span>

<span class="o">}</span>

<span class="c1">// executor/example1/Main.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">executor.example1</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="c1">// 创建一个执行服务器
</span><span class="c1"></span>    <span class="n">Server</span> <span class="n">server</span><span class="o">=</span><span class="k">new</span> <span class="n">Server</span><span class="o">();</span>

    <span class="c1">// 创建20个任务，并发给执行器，等待完成
</span><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
      <span class="n">Task</span> <span class="n">task</span><span class="o">=</span><span class="k">new</span> <span class="n">Task</span><span class="o">(</span><span class="s">&#34;Task &#34;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
      <span class="c1">//将任务提交给线程池去执行
</span><span class="c1"></span>      <span class="n">server</span><span class="o">.</span><span class="na">submitTask</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// 关闭整个线程池   
</span><span class="c1"></span>    <span class="n">server</span><span class="o">.</span><span class="na">endServer</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>运行结果
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash">Server: A new task has arrived
Server: Pool Size: <span class="m">1</span>
pool-1-thread-1: Task Task 0: Doing a task during <span class="m">148</span> seconds
Server: Active Count: <span class="m">1</span>
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">2</span>
Server: Active Count: <span class="m">2</span>
pool-1-thread-2: Task Task 1: Doing a task during <span class="m">988</span> seconds
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">3</span>
Server: Active Count: <span class="m">3</span>
pool-1-thread-3: Task Task 2: Doing a task during <span class="m">769</span> seconds
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">4</span>
Server: Active Count: <span class="m">4</span>
Server: Completed Tasks: <span class="m">0</span>
pool-1-thread-4: Task Task 3: Doing a task during <span class="m">698</span> seconds
Server: A new task has arrived
Server: Pool Size: <span class="m">5</span>
Server: Active Count: <span class="m">5</span>
pool-1-thread-5: Task Task 4: Doing a task during <span class="m">727</span> seconds
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">6</span>
Server: Active Count: <span class="m">6</span>
pool-1-thread-6: Task Task 5: Doing a task during <span class="m">232</span> seconds
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">7</span>
Server: Active Count: <span class="m">7</span>
pool-1-thread-7: Task Task 6: Doing a task during <span class="m">509</span> seconds
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">8</span>
pool-1-thread-8: Task Task 7: Doing a task during <span class="m">21</span> seconds
Server: Active Count: <span class="m">8</span>
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">9</span>
Server: Active Count: <span class="m">9</span>
pool-1-thread-9: Task Task 8: Doing a task during <span class="m">683</span> seconds
Server: Completed Tasks: <span class="m">0</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">10</span>
Server: Active Count: <span class="m">10</span>
Server: Completed Tasks: <span class="m">0</span>
pool-1-thread-10: Task Task 9: Doing a task during <span class="m">616</span> seconds
pool-1-thread-8: Task Task 7: Finished on: Mon Feb <span class="m">28</span> 21:37:57 CST <span class="m">2022</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">10</span>
pool-1-thread-8: Task Task 10: Doing a task during <span class="m">403</span> seconds
Server: Active Count: <span class="m">10</span>
Server: Completed Tasks: <span class="m">1</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">11</span>
Server: Active Count: <span class="m">11</span>
pool-1-thread-11: Task Task 11: Doing a task during <span class="m">115</span> seconds
Server: Completed Tasks: <span class="m">1</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">12</span>
Server: Active Count: <span class="m">12</span>
pool-1-thread-12: Task Task 12: Doing a task during <span class="m">966</span> seconds
Server: Completed Tasks: <span class="m">1</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">13</span>
Server: Active Count: <span class="m">13</span>
Server: Completed Tasks: <span class="m">1</span>
pool-1-thread-13: Task Task 13: Doing a task during <span class="m">224</span> seconds
Server: A new task has arrived
pool-1-thread-1: Task Task 0: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
Server: Pool Size: <span class="m">14</span>
pool-1-thread-14: Task Task 14: Doing a task during <span class="m">799</span> seconds
Server: Active Count: <span class="m">13</span>
Server: Completed Tasks: <span class="m">2</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">14</span>
pool-1-thread-1: Task Task 15: Doing a task during <span class="m">509</span> seconds
Server: Active Count: <span class="m">14</span>
Server: Completed Tasks: <span class="m">2</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">15</span>
Server: Active Count: <span class="m">15</span>
pool-1-thread-15: Task Task 16: Doing a task during <span class="m">780</span> seconds
Server: Completed Tasks: <span class="m">2</span>
Server: A new task has arrived
Server: Pool Size: <span class="m">16</span>
Server: Active Count: <span class="m">16</span>
Server: Completed Tasks: <span class="m">2</span>
pool-1-thread-16: Task Task 17: Doing a task during <span class="m">846</span> seconds
Server: A new task has arrived
Server: Pool Size: <span class="m">17</span>
Server: Active Count: <span class="m">17</span>
Server: Completed Tasks: <span class="m">2</span>
pool-1-thread-17: Task Task 18: Doing a task during <span class="m">458</span> seconds
Server: A new task has arrived
Server: Pool Size: <span class="m">18</span>
Server: Active Count: <span class="m">18</span>
pool-1-thread-18: Task Task 19: Doing a task during <span class="m">759</span> seconds
Server: Completed Tasks: <span class="m">2</span>
pool-1-thread-11: Task Task 11: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-6: Task Task 5: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-13: Task Task 13: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-8: Task Task 10: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-7: Task Task 6: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-17: Task Task 18: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-1: Task Task 15: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-10: Task Task 9: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-4: Task Task 3: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-9: Task Task 8: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-5: Task Task 4: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-3: Task Task 2: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-14: Task Task 14: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-15: Task Task 16: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-18: Task Task 19: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-2: Task Task 1: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-16: Task Task 17: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
pool-1-thread-12: Task Task 12: Finished on: Mon Feb <span class="m">28</span> 21:37:58 CST <span class="m">2022</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>实例2，利用多线程统计1-1000总和，分成10个任务计算。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">executor.example2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Callable</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SumTask</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="c1">//定义每个线程计算的区间
</span><span class="c1"></span>  <span class="kd">private</span> <span class="kt">int</span> <span class="n">startNumber</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">endNumber</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">SumTask</span><span class="o">(</span><span class="kt">int</span> <span class="n">startNumber</span><span class="o">,</span> <span class="kt">int</span> <span class="n">endNumber</span><span class="o">){</span>
    <span class="k">this</span><span class="o">.</span><span class="na">startNumber</span><span class="o">=</span><span class="n">startNumber</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">endNumber</span><span class="o">=</span><span class="n">endNumber</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">startNumber</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">endNumber</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
    <span class="o">{</span>
      <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">1000</span><span class="o">));</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s: %d\n&#34;</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span><span class="n">sum</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kn">package</span> <span class="nn">executor.example2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Future</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadPoolExecutor</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SumTest</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// 执行线程池
</span><span class="c1"></span>    <span class="n">ThreadPoolExecutor</span> <span class="n">executor</span><span class="o">=(</span><span class="n">ThreadPoolExecutor</span><span class="o">)</span><span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">4</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">resultList</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="c1">//统计1-1000总和，分成10个任务计算，提交任务
</span><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
      <span class="n">SumTask</span> <span class="n">calculator</span><span class="o">=</span><span class="k">new</span> <span class="n">SumTask</span><span class="o">(</span><span class="n">i</span><span class="o">*</span><span class="n">100</span><span class="o">+</span><span class="n">1</span><span class="o">,</span> <span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="n">1</span><span class="o">)*</span><span class="n">100</span><span class="o">);</span>
      <span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">calculator</span><span class="o">);</span>
      <span class="n">resultList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 每隔50毫秒，轮询等待10个任务结束
</span><span class="c1"></span>    <span class="k">do</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Main: 已经完成多少个任务: %d\n&#34;</span><span class="o">,</span><span class="n">executor</span><span class="o">.</span><span class="na">getCompletedTaskCount</span><span class="o">());</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">resultList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Main: Task %d: %s\n&#34;</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">result</span><span class="o">.</span><span class="na">isDone</span><span class="o">());</span>
      <span class="o">}</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">50</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">executor</span><span class="o">.</span><span class="na">getCompletedTaskCount</span><span class="o">()&lt;</span><span class="n">resultList</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

    <span class="c1">// 所有任务都已经结束了，综合计算结果    
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">resultList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
      <span class="n">Integer</span> <span class="n">sum</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">sum</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">sum</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;1-1000的总和:&#34;</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>

    <span class="c1">// 关闭线程池
</span><span class="c1"></span>    <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>运行结果
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">0</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">false</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-3: <span class="m">25050</span>
Main: 已经完成多少个任务: <span class="m">1</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">1</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">1</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">1</span>
Main: Task 0: <span class="nb">false</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-1: <span class="m">5050</span>
Main: 已经完成多少个任务: <span class="m">2</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">false</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-1: <span class="m">55050</span>
Main: 已经完成多少个任务: <span class="m">3</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">false</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-2: <span class="m">15050</span>
Main: 已经完成多少个任务: <span class="m">4</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">false</span>
Main: Task 4: <span class="nb">false</span>
pool-1-thread-4: <span class="m">35050</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">5</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">false</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-1: <span class="m">65050</span>
Main: 已经完成多少个任务: <span class="m">6</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">false</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-3: <span class="m">45050</span>
Main: 已经完成多少个任务: <span class="m">7</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">false</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-4: <span class="m">85050</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
Main: 已经完成多少个任务: <span class="m">8</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">false</span>
pool-1-thread-1: <span class="m">95050</span>
Main: 已经完成多少个任务: <span class="m">9</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">true</span>
Main: 已经完成多少个任务: <span class="m">9</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">true</span>
Main: 已经完成多少个任务: <span class="m">9</span>
Main: Task 0: <span class="nb">true</span>
Main: Task 1: <span class="nb">true</span>
Main: Task 2: <span class="nb">true</span>
Main: Task 3: <span class="nb">true</span>
Main: Task 4: <span class="nb">true</span>
Main: Task 5: <span class="nb">true</span>
Main: Task 6: <span class="nb">true</span>
Main: Task 7: <span class="nb">false</span>
Main: Task 8: <span class="nb">true</span>
Main: Task 9: <span class="nb">true</span>
pool-1-thread-2: <span class="m">75050</span>
1-1000的总和:500500
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<h2 id="4-java并发框架fork-join">4 Java并发框架<code>Fork-Join</code></h2>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>Java 7 提供另一种并行框架：分解、治理、合并（<strong>分治编程</strong>）</li>
<li>适合用于<strong>整体任务量不好确定</strong>的场合（<strong>最小任务可确定</strong>）</li>
</ul>
</div>
        </div>
    </div>
<p><strong>关键类：</strong></p>
<ul>
<li>
<p><code>ForkJoinPool</code> 任务池</p>
</li>
<li>
<p><code>RecursiveAction</code></p>
</li>
<li>
<p><code>RecursiveTask</code></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="c1">// SumTask.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.RecursiveTask</span><span class="o">;</span>

<span class="c1">//分任务求和
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SumTask</span> <span class="kd">extends</span> <span class="n">RecursiveTask</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">start</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">end</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">SumTask</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">end</span> <span class="o">=</span> <span class="n">end</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">threadhold</span> <span class="o">=</span> <span class="n">5</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">Long</span> <span class="nf">compute</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0L</span><span class="o">;</span>
    
    <span class="c1">// 如果任务小于等于阈值, 就直接执行
</span><span class="c1"></span>    <span class="kt">boolean</span> <span class="n">canCompute</span> <span class="o">=</span> <span class="o">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">threadhold</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">canCompute</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>        
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="c1">// 任务大于阈值, 分裂为2个任务
</span><span class="c1"></span>      <span class="kt">int</span> <span class="n">middle</span> <span class="o">=</span> <span class="o">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span><span class="o">)</span> <span class="o">/</span> <span class="n">2</span><span class="o">;</span>
      <span class="n">SumTask</span> <span class="n">subTask1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SumTask</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">middle</span><span class="o">);</span>
      <span class="n">SumTask</span> <span class="n">subTask2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SumTask</span><span class="o">(</span><span class="n">middle</span> <span class="o">+</span> <span class="n">1</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>

      <span class="n">invokeAll</span><span class="o">(</span><span class="n">subTask1</span><span class="o">,</span> <span class="n">subTask2</span><span class="o">);</span>

      <span class="n">Long</span> <span class="n">sum1</span> <span class="o">=</span> <span class="n">subTask1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
      <span class="n">Long</span> <span class="n">sum2</span> <span class="o">=</span> <span class="n">subTask2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

      <span class="c1">// 结果合并
</span><span class="c1"></span>      <span class="n">sum</span> <span class="o">=</span> <span class="n">sum1</span> <span class="o">+</span> <span class="n">sum2</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// SumTest.java
</span><span class="c1"></span><span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ForkJoinPool</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ForkJoinTask</span><span class="o">;</span>

<span class="c1">//分任务求和
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SumTest</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ExecutionException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
      <span class="c1">//创建执行线程池
</span><span class="c1"></span>      <span class="n">ForkJoinPool</span> <span class="n">pool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ForkJoinPool</span><span class="o">();</span>
      <span class="c1">//ForkJoinPool pool = new ForkJoinPool(4);
</span><span class="c1"></span>      
      <span class="c1">//创建任务
</span><span class="c1"></span>      <span class="n">SumTask</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SumTask</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">10000000</span><span class="o">);</span>
        
        <span class="o">/</span><span class="n">提交任务</span>
      <span class="n">ForkJoinTask</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
        
      <span class="c1">//等待结果
</span><span class="c1"></span>      <span class="k">do</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Main: Thread Count: %d\n&#34;</span><span class="o">,</span><span class="n">pool</span><span class="o">.</span><span class="na">getActiveThreadCount</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Main: Paralelism: %d\n&#34;</span><span class="o">,</span><span class="n">pool</span><span class="o">.</span><span class="na">getParallelism</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">50</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span> <span class="k">while</span> <span class="o">(!</span><span class="n">task</span><span class="o">.</span><span class="na">isDone</span><span class="o">());</span>
          
          <span class="c1">//输出结果
</span><span class="c1"></span>          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
      <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="5-java并发数据结构">5 Java并发数据结构</h2>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>常用的数据结构是线程不安全的
<ul>
<li><code>ArrayList</code>,<code> HashMap</code>, <code>HashSet</code> 非同步的</li>
<li>多个线程同时读写，可能会抛出异常或数据错误</li>
</ul>
</li>
<li>传统<code>Vector</code>，<code>Hashtable</code>等同步集合性能过差</li>
<li>并发数据结构：数据添加和删除
<ul>
<li>阻塞式集合：当集合为空或者满时，等待</li>
<li>非阻塞式集合：当集合为空或者满时，不等待，返回<code>null</code>或异常</li>
</ul>
</li>
</ul>
</div>
        </div>
    </div>
<h3 id="51-list">5.1 List</h3>
<ul>
<li><code>Vector</code> 同步安全，<strong>写多读少</strong></li>
<li><code>ArrayList</code> 不安全</li>
<li><code>Collections.synchronizedList(List list)</code> 基于<code>synchronized</code>，效率差</li>
<li><code>CopyOnWriteArrayList</code> <strong>读多写少</strong>，基于复制机制，非阻塞</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">list</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CopyOnWriteArrayList</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListTest</span> <span class="o">{</span>    
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">{</span>

        <span class="c1">//线程不安全
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unsafeList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="c1">//线程安全
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeList1</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;());</span>
        <span class="c1">//线程安全
</span><span class="c1"></span>        <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeList2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">ListThread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListThread</span><span class="o">(</span><span class="n">unsafeList</span><span class="o">);</span>
        <span class="n">ListThread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListThread</span><span class="o">(</span><span class="n">safeList1</span><span class="o">);</span>
        <span class="n">ListThread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListThread</span><span class="o">(</span><span class="n">safeList2</span><span class="o">);</span>

        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t3</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//等待子线程执行完
</span><span class="c1"></span>        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
 
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;listThread1.list.size() = &#34;</span> <span class="o">+</span> <span class="n">t1</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;listThread2.list.size() = &#34;</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;listThread3.list.size() = &#34;</span> <span class="o">+</span> <span class="n">t3</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

        <span class="c1">//输出list中的值
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;unsafeList：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span> <span class="o">:</span> <span class="n">t1</span><span class="o">.</span><span class="na">list</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">s</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&#34;null  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span>
            <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeList1：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span> <span class="o">:</span> <span class="n">t2</span><span class="o">.</span><span class="na">list</span><span class="o">){</span>
          <span class="k">if</span><span class="o">(</span><span class="n">s</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&#34;null  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span>
            <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeList2：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span> <span class="o">:</span> <span class="n">t3</span><span class="o">.</span><span class="na">list</span><span class="o">){</span>
          <span class="k">if</span><span class="o">(</span><span class="n">s</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&#34;null  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span>
            <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ListThread</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ListThread</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">list</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
      <span class="k">while</span><span class="o">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">10</span><span class="o">)</span>
      <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="c1">//把当前线程名称加入list中
</span><span class="c1"></span>            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="n">i</span><span class="o">++;</span>
      <span class="o">}</span>        
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * listThread1.list.size() = 95
</span><span class="cm"> * listThread2.list.size() = 100
</span><span class="cm"> * listThread3.list.size() = 100
</span><span class="cm"> * unsafeList：
</span><span class="cm"> * 5  6  3  8  4  7  9  2  0  1  1  2  3  9  6  5  7  8  4  0  5  9  null  null  null  2  4  7  8  0  6  1  3  9  7  5  4  8  0  1  2  9  3  7  4  5  8  0  7  null  null  null  5  2  6  4  8  0  1  8  5  9  3  2  7  0  4  2  3  4  9  7  1  null  null  5  0  1  9  2  3  5  8  4  7  0  7  5  9  3  8  0  2  1  4  
</span><span class="cm"> * safeList1：
</span><span class="cm"> * 3  2  8  1  0  4  5  7  6  9  7  2  0  4  8  3  6  9  1  5  2  0  8  7  4  3  1  9  6  5  9  3  7  8  2  0  6  4  1  5  9  2  8  7  3  6  0  4  1  5  0  7  8  2  9  4  3  1  6  5  3  7  8  2  1  5  6  4  9  0  1  4  9  7  5  8  0  2  3  6  2  0  8  6  9  7  1  3  5  4  5  2  8  0  4  3  9  6  1  7  
</span><span class="cm"> * safeList2：
</span><span class="cm"> * 6  0  4  3  2  9  5  8  7  1  7  8  6  9  4  5  3  2  0  1  2  8  7  4  0  9  5  6  1  3  0  9  4  2  1  3  6  7  8  5  0  6  8  9  1  7  5  2  4  3  8  0  7  4  9  3  5  6  1  2  6  8  9  3  5  2  1  7  0  4  4  0  8  5  7  1  2  6  3  9  3  5  6  8  2  9  7  1  0  4  2  0  4  9  3  8  6  5  7  1  
</span><span class="cm"> *
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="52-set">5.2 Set</h3>
<ul>
<li><code>HashSet</code> 不安全</li>
<li><code>Collections.synchronizedSet(Set set)</code> 基于<code>synchronized</code>，效率差</li>
<li><code>CopyOnWriteArraySet</code> (基于CopyOnWriteArrayList实现) <strong>读多写少</strong>，
非阻塞</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CopyOnWriteArraySet</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SetTest</span><span class="o">{</span>  
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">{</span>

        <span class="c1">//线程不安全
</span><span class="c1"></span>        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unsafeSet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="c1">//线程安全
</span><span class="c1"></span>        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeSet1</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">synchronizedSet</span><span class="o">(</span><span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;());</span>
        <span class="c1">//线程安全
</span><span class="c1"></span>        <span class="n">CopyOnWriteArraySet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeSet2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArraySet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">SetThread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SetThread</span><span class="o">(</span><span class="n">unsafeSet</span><span class="o">);</span>
        <span class="n">SetThread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SetThread</span><span class="o">(</span><span class="n">safeSet1</span><span class="o">);</span>
        <span class="n">SetThread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SetThread</span><span class="o">(</span><span class="n">safeSet2</span><span class="o">);</span>

        <span class="c1">//unsafeSet的运行测试
</span><span class="c1"></span>        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
          <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
          <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t3</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//等待子线程执行完
</span><span class="c1"></span>        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
 
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;setThread1.set.size() = &#34;</span> <span class="o">+</span> <span class="n">t1</span><span class="o">.</span><span class="na">set</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;setThread2.set.size() = &#34;</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="na">set</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;setThread3.set.size() = &#34;</span> <span class="o">+</span> <span class="n">t3</span><span class="o">.</span><span class="na">set</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

        <span class="c1">//输出set中的值
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;unsafeSet：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">:</span><span class="n">t1</span><span class="o">.</span><span class="na">set</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">element</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&#34;null  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span>
            <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">element</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeSet1：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">:</span><span class="n">t2</span><span class="o">.</span><span class="na">set</span><span class="o">){</span>
          <span class="k">if</span><span class="o">(</span><span class="n">element</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&#34;null  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span>
            <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">element</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeSet2：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">:</span><span class="n">t3</span><span class="o">.</span><span class="na">set</span><span class="o">){</span>
          <span class="k">if</span><span class="o">(</span><span class="n">element</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&#34;null  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span>
            <span class="o">{</span>
              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">element</span> <span class="o">+</span> <span class="s">&#34;  &#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SetThread</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
  <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SetThread</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">set</span> <span class="o">=</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
      <span class="k">while</span><span class="o">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">10</span><span class="o">)</span>
      <span class="o">{</span>
        <span class="n">i</span><span class="o">++;</span>
        <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="c1">//把当前线程名称加入list中
</span><span class="c1"></span>            <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
      <span class="o">}</span>        
    <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * setThread1.set.size() = 97
</span><span class="cm"> * setThread2.set.size() = 100
</span><span class="cm"> * setThread3.set.size() = 100
</span><span class="cm"> * unsafeSet：
</span><span class="cm"> * 44  88  45  89  02  46  03  47  04  48  05  49  06  07  08  09  110  310  510  710  910  92  93  94  51  95  96  53  97  54  98  55  99  56  13  57  14  58  15  59  16  17  18  19  62  63  64  65  66  23  67  24  68  25  69  26  27  28  29  010  210  410  610  810  73  74  75  32  76  33  77  34  78  35  79  36  37  38  39  83  84  85  42  86  43  87  
</span><span class="cm"> * safeSet1：
</span><span class="cm"> * 88  01  89  02  03  04  05  06  07  08  09  110  510  91  910  92  93  94  95  96  97  98  11  99  12  13  14  15  16  17  18  19  21  22  23  24  25  26  27  28  29  010  410  810  31  32  33  34  35  36  37  38  39  41  42  43  44  45  46  47  48  49  310  710  51  52  53  54  55  56  57  58  59  61  62  63  64  65  66  67  68  69  210  610  71  72  73  74  75  76  77  78  79  81  82  83  84  85  86  87  
</span><span class="cm"> * safeSet2：
</span><span class="cm"> * 21  61  51  41  01  91  81  11  71  31  22  62  32  52  82  92  12  42  02  72  93  23  83  13  33  43  73  53  03  63  24  64  84  34  04  54  94  74  44  14  25  95  15  05  55  35  75  85  65  45  86  36  76  06  56  66  16  96  26  46  27  47  97  57  77  87  67  07  37  17  98  08  38  58  78  48  18  88  68  28  09  39  29  19  49  59  79  89  99  69  610  110  910  510  810  410  010  210  310  710 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="53-map">5.3 Map</h3>
<ul>
<li><code>Hashtable</code> 同步安全，<strong>写多读少</strong></li>
<li><code>HashMap</code> 不安全</li>
<li><code>Collections.synchronizedMap(Map map)</code> 基于<code>synchronized</code>，效率差</li>
<li><code>ConcurrentHashMap</code> <strong>读多写少</strong>，非阻塞</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapTest</span><span class="o">{</span>    
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">{</span>

        <span class="c1">//线程不安全
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unsafeMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="c1">//线程安全
</span><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeMap1</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">synchronizedMap</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;());</span>
        <span class="c1">//线程安全
</span><span class="c1"></span>        <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeMap2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">MapThread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapThread</span><span class="o">(</span><span class="n">unsafeMap</span><span class="o">);</span>
        <span class="n">MapThread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapThread</span><span class="o">(</span><span class="n">safeMap1</span><span class="o">);</span>
        <span class="n">MapThread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapThread</span><span class="o">(</span><span class="n">safeMap2</span><span class="o">);</span>

        <span class="c1">//unsafeMap的运行测试
</span><span class="c1"></span>        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
          <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t1</span><span class="o">);</span>
          <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>       
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t2</span><span class="o">);</span>
            <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t3</span><span class="o">);</span>
            <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//等待子线程执行完
</span><span class="c1"></span>        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
 
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;mapThread1.map.size() = &#34;</span> <span class="o">+</span> <span class="n">t1</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;mapThread2.map.size() = &#34;</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;mapThread3.map.size() = &#34;</span> <span class="o">+</span> <span class="n">t3</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

        <span class="c1">//输出set中的值
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;unsafeMap：&#34;</span><span class="o">);</span>
        <span class="n">Iterator</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">=</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;)</span><span class="n">iter</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="c1">// 获取key
</span><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span><span class="o">);</span>
            <span class="c1">// 获取value
</span><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeMap1：&#34;</span><span class="o">);</span>
        <span class="n">iter</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">=</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;)</span><span class="n">iter</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="c1">// 获取key
</span><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span><span class="o">);</span>
            <span class="c1">// 获取value
</span><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeMap2：&#34;</span><span class="o">);</span>
        <span class="n">iter</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">=</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;)</span><span class="n">iter</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="c1">// 获取key
</span><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span><span class="o">);</span>
            <span class="c1">// 获取value
</span><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;mapThread1.map.size() = &#34;</span> <span class="o">+</span> <span class="n">t1</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;mapThread2.map.size() = &#34;</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;mapThread3.map.size() = &#34;</span> <span class="o">+</span> <span class="n">t3</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MapThread</span> <span class="kd">implements</span> <span class="n">Runnable</span>
<span class="o">{</span>
  <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MapThread</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">map</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span>
        
        <span class="k">while</span><span class="o">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">100</span><span class="o">)</span>
        <span class="o">{</span>
          <span class="c1">//把当前线程名称加入map中
</span><span class="c1"></span>            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">++,</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>        
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * mapThread1.map.size() = 123
</span><span class="cm"> * mapThread2.map.size() = 100
</span><span class="cm"> * mapThread3.map.size() = 100
</span><span class="cm"> * unsafeMap：
</span><span class="cm"> * 0:Thread-9 1:Thread-0 2:Thread-5 3:Thread-1 4:Thread-7 5:Thread-7 6:Thread-4 7:Thread-9 8:Thread-8 9:Thread-2 10:Thread-6 11:Thread-5 12:Thread-7 13:Thread-7 14:Thread-0 15:Thread-0 16:Thread-6 17:Thread-7 18:Thread-6 19:Thread-7 20:Thread-7 21:Thread-0 22:Thread-5 23:Thread-0 24:Thread-3 25:Thread-0 26:Thread-5 27:Thread-7 28:Thread-0 29:Thread-2 30:Thread-2 31:Thread-1 32:Thread-3 33:Thread-9 34:Thread-7 35:Thread-0 36:Thread-0 37:Thread-0 38:Thread-7 39:Thread-6 40:Thread-7 41:Thread-7 42:Thread-0 43:Thread-0 44:Thread-6 45:Thread-7 46:Thread-8 47:Thread-6 48:Thread-9 49:Thread-0 50:Thread-1 51:Thread-2 52:Thread-6 53:Thread-7 54:Thread-7 55:Thread-0 56:Thread-2 57:Thread-2 58:Thread-5 59:Thread-9 60:Thread-7 61:Thread-2 62:Thread-0 63:Thread-8 64:Thread-6 65:Thread-8 66:Thread-0 67:Thread-8 68:Thread-8 69:Thread-0 70:Thread-1 71:Thread-7 72:Thread-9 73:Thread-7 74:Thread-9 75:Thread-7 76:Thread-0 77:Thread-7 78:Thread-8 79:Thread-8 80:Thread-8 81:Thread-7 82:Thread-8 83:Thread-7 84:Thread-1 85:Thread-0 86:Thread-5 87:Thread-8 88:Thread-5 89:Thread-8 90:Thread-8 91:Thread-1 92:Thread-8 93:Thread-7 94:Thread-8 95:Thread-0 96:Thread-7 97:Thread-0 98:Thread-5 99:Thread-7 
</span><span class="cm"> * safeMap1：
</span><span class="cm"> * 0:Thread-16 1:Thread-14 2:Thread-14 3:Thread-12 4:Thread-11 5:Thread-15 6:Thread-18 7:Thread-18 8:Thread-18 9:Thread-11 10:Thread-18 11:Thread-12 12:Thread-16 13:Thread-15 14:Thread-18 15:Thread-15 16:Thread-12 17:Thread-13 18:Thread-12 19:Thread-18 20:Thread-12 21:Thread-16 22:Thread-14 23:Thread-19 24:Thread-13 25:Thread-11 26:Thread-15 27:Thread-18 28:Thread-15 29:Thread-19 30:Thread-17 31:Thread-10 32:Thread-18 33:Thread-17 34:Thread-16 35:Thread-16 36:Thread-15 37:Thread-15 38:Thread-13 39:Thread-18 40:Thread-11 41:Thread-15 42:Thread-18 43:Thread-16 44:Thread-18 45:Thread-16 46:Thread-18 47:Thread-10 48:Thread-18 49:Thread-13 50:Thread-18 51:Thread-14 52:Thread-11 53:Thread-15 54:Thread-18 55:Thread-15 56:Thread-10 57:Thread-18 58:Thread-18 59:Thread-14 60:Thread-16 61:Thread-19 62:Thread-16 63:Thread-11 64:Thread-14 65:Thread-16 66:Thread-13 67:Thread-16 68:Thread-16 69:Thread-15 70:Thread-10 71:Thread-16 72:Thread-10 73:Thread-14 74:Thread-17 75:Thread-17 76:Thread-15 77:Thread-16 78:Thread-15 79:Thread-16 80:Thread-16 81:Thread-15 82:Thread-13 83:Thread-15 84:Thread-17 85:Thread-18 86:Thread-10 87:Thread-16 88:Thread-14 89:Thread-16 90:Thread-16 91:Thread-13 92:Thread-16 93:Thread-16 94:Thread-15 95:Thread-15 96:Thread-16 97:Thread-15 98:Thread-16 99:Thread-16 
</span><span class="cm"> * safeMap2：
</span><span class="cm"> * 0:Thread-29 1:Thread-21 2:Thread-23 3:Thread-25 4:Thread-26 5:Thread-24 6:Thread-24 7:Thread-25 8:Thread-24 9:Thread-22 10:Thread-27 11:Thread-21 12:Thread-24 13:Thread-28 14:Thread-22 15:Thread-23 16:Thread-29 17:Thread-22 18:Thread-20 19:Thread-24 20:Thread-26 21:Thread-24 22:Thread-29 23:Thread-28 24:Thread-29 25:Thread-21 26:Thread-29 27:Thread-25 28:Thread-26 29:Thread-29 30:Thread-25 31:Thread-25 32:Thread-27 33:Thread-26 34:Thread-20 35:Thread-23 36:Thread-22 37:Thread-29 38:Thread-24 39:Thread-25 40:Thread-20 41:Thread-24 42:Thread-26 43:Thread-23 44:Thread-25 45:Thread-23 46:Thread-23 47:Thread-22 48:Thread-22 49:Thread-23 50:Thread-23 51:Thread-22 52:Thread-23 53:Thread-20 54:Thread-29 55:Thread-24 56:Thread-26 57:Thread-26 58:Thread-21 59:Thread-29 60:Thread-23 61:Thread-27 62:Thread-24 63:Thread-21 64:Thread-29 65:Thread-24 66:Thread-27 67:Thread-23 68:Thread-24 69:Thread-23 70:Thread-25 71:Thread-23 72:Thread-26 73:Thread-23 74:Thread-25 75:Thread-23 76:Thread-22 77:Thread-23 78:Thread-22 79:Thread-24 80:Thread-24 81:Thread-23 82:Thread-24 83:Thread-23 84:Thread-25 85:Thread-25 86:Thread-21 87:Thread-24 88:Thread-29 89:Thread-24 90:Thread-24 91:Thread-23 92:Thread-24 93:Thread-26 94:Thread-23 95:Thread-23 96:Thread-29 97:Thread-25 98:Thread-29 99:Thread-26 
</span><span class="cm"> * mapThread1.map.size() = 123
</span><span class="cm"> * mapThread2.map.size() = 100
</span><span class="cm"> * mapThread3.map.size() = 100
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="54-queue--deque-队列jdk-15-提出">5.4 Queue &amp; Deque (队列，JDK 1.5 提出)</h3>
<ul>
<li><code>ConcurrentLinkedQueue</code> 非阻塞</li>
<li><code>ArrayBlockingQueue/LinkedBlockingQueue</code> 阻塞</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">queue</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ArrayBlockingQueue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentLinkedDeque</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QueueTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">{</span>

        <span class="c1">//线程不安全
</span><span class="c1"></span>        <span class="n">Deque</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unsafeQueue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayDeque</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="c1">//线程安全
</span><span class="c1"></span>        <span class="n">ConcurrentLinkedDeque</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeQueue1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentLinkedDeque</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">ArrayBlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">safeQueue2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">100</span><span class="o">);</span>

        <span class="n">QueueThread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueueThread</span><span class="o">(</span><span class="n">unsafeQueue</span><span class="o">);</span>
        <span class="n">QueueThread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueueThread</span><span class="o">(</span><span class="n">safeQueue1</span><span class="o">);</span>
        <span class="n">QueueThread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueueThread</span><span class="o">(</span><span class="n">safeQueue2</span><span class="o">);</span>

        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Thread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Thread</span> <span class="n">thread3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t3</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="n">thread3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//等待子线程执行完
</span><span class="c1"></span>        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
 
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;queueThread1.queue.size() = &#34;</span> <span class="o">+</span> <span class="n">t1</span><span class="o">.</span><span class="na">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;queueThread2.queue.size() = &#34;</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="na">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;queueThread3.queue.size() = &#34;</span> <span class="o">+</span> <span class="n">t3</span><span class="o">.</span><span class="na">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

        <span class="c1">//输出queue中的值
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;unsafeQueue：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">:</span><span class="n">t1</span><span class="o">.</span><span class="na">queue</span><span class="o">)</span>
        <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeQueue1：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">:</span><span class="n">t2</span><span class="o">.</span><span class="na">queue</span><span class="o">)</span>
        <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;safeQueue2：&#34;</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">:</span><span class="n">t3</span><span class="o">.</span><span class="na">queue</span><span class="o">)</span>
        <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">QueueThread</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
  <span class="kd">public</span> <span class="n">Queue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">QueueThread</span><span class="o">(</span><span class="n">Queue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
      <span class="k">while</span><span class="o">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">10</span><span class="o">)</span>
      <span class="o">{</span>
        <span class="n">i</span><span class="o">++;</span>
        <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="c1">//把当前线程名称加入list中
</span><span class="c1"></span>            <span class="n">queue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
      <span class="o">}</span>        
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * queueThread1.queue.size() = 83
</span><span class="cm"> * queueThread2.queue.size() = 100
</span><span class="cm"> * queueThread3.queue.size() = 100
</span><span class="cm"> * unsafeQueue：
</span><span class="cm"> * 1 8 4 3 7 6 0 0 5 3 2 8 4 0 7 6 6 4 3 2 9 1 5 8 0 4 2 3 5 8 9 1 6 5 7 3 1 9 4 2 0 2 9 1 5 4 3 6 8 0 7 0 5 2 3 1 4 9 8 7 6 9 2 5 2 9 1 4 3 5 6 8 7 0 6 8 0 2 7 3 4 9 1 
</span><span class="cm"> * safeQueue1：
</span><span class="cm"> * 4 8 1 7 2 9 0 6 3 5 3 4 0 9 5 1 7 6 2 8 8 2 9 1 7 0 4 3 6 5 2 4 1 8 7 3 0 9 6 5 4 0 7 3 8 9 1 2 5 6 8 0 7 3 2 1 9 4 6 5 4 7 0 8 6 3 9 1 2 5 3 8 7 4 0 5 2 6 1 9 7 0 2 8 9 1 4 3 6 5 3 8 5 6 0 4 1 9 7 2 
</span><span class="cm"> * safeQueue2：
</span><span class="cm"> * 6 3 2 5 1 9 4 8 0 7 5 8 7 1 3 6 4 0 9 2 6 1 9 7 5 8 0 2 3 4 1 6 7 5 8 3 0 4 9 2 1 2 9 7 5 4 3 0 6 8 0 5 2 8 6 3 4 9 1 7 4 9 1 6 2 0 3 8 7 5 8 2 7 6 0 3 1 9 5 4 6 8 5 0 7 1 2 9 3 4 4 3 9 5 0 2 1 6 8 7 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> */</span> 
</code></pre></td></tr></table>
</div>
</div><h2 id="6-java并发协作控制">6 Java并发协作控制</h2>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><code>Thread/Executor/Fork-Join</code>
<ul>
<li>线程启动，运行，结束</li>
<li>线程之间缺少协作</li>
</ul>
</li>
<li><code>synchronized</code> 同步
<ul>
<li>限定只有一个线程才能进入关键区</li>
<li>简单粗暴，<strong>性能损失有点大</strong></li>
</ul>
</li>
</ul>
</div>
        </div>
    </div>
<h3 id="61-lock">6.1 <code>Lock</code></h3>
<ul>
<li>Lock也可以实现同步的效果
<ul>
<li>实现更复杂的临界区结构</li>
<li><code>tryLock</code>方法可以预判锁是否空闲</li>
<li>允许分离读写的操作，多个读，一个写</li>
<li>性能更好</li>
</ul>
</li>
<li><code>ReentrantLock</code>类，可重入的互斥锁</li>
<li><code>ReentrantReadWriteLock</code>类，可重入的读写锁</li>
<li><code>lock</code>和<code>unlock</code>函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Lock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.ReadWriteLock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.ReentrantLock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.ReentrantReadWriteLock</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LockExample</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">queueLock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span> <span class="c1">//可重入锁
</span><span class="c1"></span>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ReentrantReadWriteLock</span> <span class="n">orderLock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantReadWriteLock</span><span class="o">();</span> <span class="c1">//可重入读写锁
</span><span class="c1"></span>  
  <span class="cm">/**
</span><span class="cm">   * 有家奶茶店，点单有时需要排队 
</span><span class="cm">   * 假设想买奶茶的人如果看到需要排队，就决定不买
</span><span class="cm">   * 又假设奶茶店有老板和多名员工，记单方式比较原始，只有一个订单本
</span><span class="cm">   * 老板负责写新订单，员工不断地查看订单本得到信息来制作奶茶，在老板写新订单时员工不能看订单本
</span><span class="cm">   * 多个员工可同时看订单本，在员工看时老板不能写新订单
</span><span class="cm">   * @param args
</span><span class="cm">   * @throws InterruptedException 
</span><span class="cm">   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">buyMilkTea</span><span class="o">();</span>
    <span class="c1">//handleOrder(); //需手动关闭
</span><span class="c1"></span>  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tryToBuyMilkTea</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="k">while</span><span class="o">(</span><span class="n">flag</span><span class="o">)</span>
    <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">queueLock</span><span class="o">.</span><span class="na">tryLock</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">//queueLock.lock();
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">thinkingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">500</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">thinkingTime</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;： 来一杯珍珠奶茶，不要珍珠&#34;</span><span class="o">);</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">queueLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">//System.out.println(Thread.currentThread().getName() + &#34;：&#34; + queueLock.getQueueLength() + &#34;人在排队&#34;);
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;： 再等等&#34;</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">if</span><span class="o">(</span><span class="n">flag</span><span class="o">)</span>
      <span class="o">{</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addOrder</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="c1">//writeLock，写锁，排他的，只能一个线程拥有
</span><span class="c1"></span>    <span class="n">orderLock</span><span class="o">.</span><span class="na">writeLock</span><span class="o">().</span><span class="na">lock</span><span class="o">();</span>
    <span class="kt">long</span> <span class="n">writingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">1000</span><span class="o">);</span>
    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">writingTime</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;老板新加一笔订单&#34;</span><span class="o">);</span>
    <span class="n">orderLock</span><span class="o">.</span><span class="na">writeLock</span><span class="o">().</span><span class="na">unlock</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">viewOrder</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="c1">//readLock，读锁，可以多个线程共享
</span><span class="c1"></span>    <span class="n">orderLock</span><span class="o">.</span><span class="na">readLock</span><span class="o">().</span><span class="na">lock</span><span class="o">();</span>
      
    <span class="kt">long</span> <span class="n">readingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">500</span><span class="o">);</span>
    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">readingTime</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;: 查看订单本&#34;</span><span class="o">);</span>
    <span class="n">orderLock</span><span class="o">.</span><span class="na">readLock</span><span class="o">().</span><span class="na">unlock</span><span class="o">();</span>      

  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">buyMilkTea</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">LockExample</span> <span class="n">lockExample</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LockExample</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">STUDENTS_CNT</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
    
    <span class="n">Thread</span><span class="o">[]</span> <span class="n">students</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">STUDENTS_CNT</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">STUDENTS_CNT</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">students</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">try</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">walkingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">1000</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">walkingTime</span><span class="o">);</span>
            <span class="n">lockExample</span><span class="o">.</span><span class="na">tryToBuyMilkTea</span><span class="o">();</span>
          <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
          <span class="o">}</span>
        <span class="o">}</span>
        
      <span class="o">}</span>
      <span class="o">);</span>
      
      <span class="n">students</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">STUDENTS_CNT</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">students</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">join</span><span class="o">();</span>

  <span class="o">}</span>
  
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleOrder</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">LockExample</span> <span class="n">lockExample</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LockExample</span><span class="o">();</span>
    
    
    <span class="n">Thread</span> <span class="n">boss</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">try</span> <span class="o">{</span>
            <span class="n">lockExample</span><span class="o">.</span><span class="na">addOrder</span><span class="o">();</span>
            <span class="kt">long</span> <span class="n">waitingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">1000</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">waitingTime</span><span class="o">);</span>
          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">});</span>
    <span class="n">boss</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

    <span class="kt">int</span> <span class="n">workerCnt</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span>
    <span class="n">Thread</span><span class="o">[]</span> <span class="n">workers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">workerCnt</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">workerCnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
    <span class="o">{</span>
      <span class="n">workers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">lockExample</span><span class="o">.</span><span class="na">viewOrder</span><span class="o">();</span>
                <span class="kt">long</span> <span class="n">workingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">5000</span><span class="o">);</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">workingTime</span><span class="o">);</span>
              <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
              <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        
      <span class="o">});</span>
      
      <span class="n">workers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    
  <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * Thread-2： 再等等
</span><span class="cm"> * Thread-0： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-3： 再等等
</span><span class="cm"> * Thread-6： 再等等
</span><span class="cm"> * Thread-9： 再等等
</span><span class="cm"> * Thread-8： 再等等
</span><span class="cm"> * Thread-1： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-5： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-7： 再等等
</span><span class="cm"> * Thread-4： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-3： 再等等
</span><span class="cm"> * Thread-6： 再等等
</span><span class="cm"> * Thread-2： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-8： 再等等
</span><span class="cm"> * Thread-9： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-7： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-6： 再等等
</span><span class="cm"> * Thread-8： 再等等
</span><span class="cm"> * Thread-3： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-8： 再等等
</span><span class="cm"> * Thread-6： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> * Thread-8： 来一杯珍珠奶茶，不要珍珠
</span><span class="cm"> *
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="62-semaphore">6.2 <code>Semaphore</code></h3>
<ul>
<li>信号量，由1965年Dijkstra提出的</li>
<li>信号量：本质上是一个计数器</li>
<li>计数器大于0，可以使用，等于0不能使用</li>
<li>可以设置多个并发量，例如限制10个访问</li>
<li><code>Semaphore</code>
<ul>
<li><code>acquire</code>获取</li>
<li><code>release</code>释放</li>
</ul>
</li>
<li>比<code>Lock</code>更进一步，可以控制多个同时访问关键区</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">import</span> <span class="nn">java.util.concurrent.Semaphore</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SemaphoreExample</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Semaphore</span> <span class="n">placeSemaphore</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
  
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">parking</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">placeSemaphore</span><span class="o">.</span><span class="na">tryAcquire</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;: 停车成功&#34;</span><span class="o">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;: 没有空位&#34;</span><span class="o">);</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaving</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">placeSemaphore</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;: 开走&#34;</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="cm">/**
</span><span class="cm">   * 现有一地下车库，共有车位5个，由10辆车需要停放，每次停放时，去申请信号量
</span><span class="cm">   * @param args
</span><span class="cm">   * @throws InterruptedException 
</span><span class="cm">   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">tryToParkCnt</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
    
    <span class="n">SemaphoreExample</span> <span class="n">semaphoreExample</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SemaphoreExample</span><span class="o">();</span>
    
    <span class="n">Thread</span><span class="o">[]</span> <span class="n">parkers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">tryToParkCnt</span><span class="o">];</span>
    
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tryToParkCnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">parkers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">try</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">randomTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">1000</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">randomTime</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">semaphoreExample</span><span class="o">.</span><span class="na">parking</span><span class="o">())</span> <span class="o">{</span>
              <span class="kt">long</span> <span class="n">parkingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">1200</span><span class="o">);</span>
              <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">parkingTime</span><span class="o">);</span>
              <span class="n">semaphoreExample</span><span class="o">.</span><span class="na">leaving</span><span class="o">();</span>
            <span class="o">}</span>
          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">});</span>
      
      <span class="n">parkers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tryToParkCnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">parkers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">join</span><span class="o">();</span>
    <span class="o">}</span> 
  <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * Thread-5: 停车成功
</span><span class="cm"> * Thread-9: 停车成功
</span><span class="cm"> * Thread-9: 开走
</span><span class="cm"> * Thread-6: 停车成功
</span><span class="cm"> * Thread-8: 停车成功
</span><span class="cm"> * Thread-2: 停车成功
</span><span class="cm"> * Thread-4: 停车成功
</span><span class="cm"> * Thread-0: 没有空位
</span><span class="cm"> * Thread-4: 开走
</span><span class="cm"> * Thread-7: 停车成功
</span><span class="cm"> * Thread-2: 开走
</span><span class="cm"> * Thread-3: 停车成功
</span><span class="cm"> * Thread-6: 开走
</span><span class="cm"> * Thread-1: 停车成功
</span><span class="cm"> * Thread-5: 开走
</span><span class="cm"> * Thread-8: 开走
</span><span class="cm"> * Thread-3: 开走
</span><span class="cm"> * Thread-1: 开走
</span><span class="cm"> * Thread-7: 开走
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="63-latch">6.3 <code>Latch</code></h3>
<ul>
<li>等待锁，是一个同步辅助类</li>
<li>用来同步执行任务的一个或者多个线程</li>
<li>不是用来保护临界区或者共享资源</li>
<li><code>CountDownLatch</code>
<ul>
<li><code>countDown()</code> 计数减1</li>
<li><code>await()</code> 等待latch变成0</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">
<span class="kn">import</span> <span class="nn">java.util.concurrent.CountDownLatch</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountDownLatchExample</span> <span class="o">{</span>

  <span class="cm">/**
</span><span class="cm">   * 设想百米赛跑比赛 发令枪发出信号后选手开始跑，全部选手跑到终点后比赛结束
</span><span class="cm">   * 
</span><span class="cm">   * @param args
</span><span class="cm">   * @throws InterruptedException
</span><span class="cm">   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">runnerCnt</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
    <span class="n">CountDownLatch</span> <span class="n">startSignal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
    <span class="n">CountDownLatch</span> <span class="n">doneSignal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="o">(</span><span class="n">runnerCnt</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">runnerCnt</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="c1">// create and start threads
</span><span class="c1"></span>      <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Worker</span><span class="o">(</span><span class="n">startSignal</span><span class="o">,</span> <span class="n">doneSignal</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;准备工作...&#34;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;准备工作就绪&#34;</span><span class="o">);</span>
    <span class="n">startSignal</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span> <span class="c1">// let all threads proceed
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;比赛开始&#34;</span><span class="o">);</span>
    <span class="n">doneSignal</span><span class="o">.</span><span class="na">await</span><span class="o">();</span> <span class="c1">// wait for all to finish
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;比赛结束&#34;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Worker</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">CountDownLatch</span> <span class="n">startSignal</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">CountDownLatch</span> <span class="n">doneSignal</span><span class="o">;</span>

    <span class="n">Worker</span><span class="o">(</span><span class="n">CountDownLatch</span> <span class="n">startSignal</span><span class="o">,</span> <span class="n">CountDownLatch</span> <span class="n">doneSignal</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">startSignal</span> <span class="o">=</span> <span class="n">startSignal</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">doneSignal</span> <span class="o">=</span> <span class="n">doneSignal</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">startSignal</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
        <span class="n">doWork</span><span class="o">();</span>
        <span class="n">doneSignal</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">}</span> <span class="c1">// return;
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">doWork</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;: 跑完全程&#34;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 准备工作...
</span><span class="cm"> * 准备工作就绪
</span><span class="cm"> * 比赛开始
</span><span class="cm"> * Thread-0: 跑完全程
</span><span class="cm"> * Thread-6: 跑完全程
</span><span class="cm"> * Thread-9: 跑完全程
</span><span class="cm"> * Thread-5: 跑完全程
</span><span class="cm"> * Thread-4: 跑完全程
</span><span class="cm"> * Thread-8: 跑完全程
</span><span class="cm"> * Thread-3: 跑完全程
</span><span class="cm"> * Thread-2: 跑完全程
</span><span class="cm"> * Thread-1: 跑完全程
</span><span class="cm"> * Thread-7: 跑完全程
</span><span class="cm"> * 比赛结束
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="64-barrier">6.4 <code>Barrier</code></h3>
<ul>
<li>集合点，也是一个同步辅助类</li>
<li>允许多个线程在某一个点上进行同步</li>
<li><code>CyclicBarrier</code>
<ul>
<li>构造函数是需要同步的线程数量</li>
<li><code>await</code>等待其他线程，到达数量后，就放行</li>
</ul>
</li>
</ul>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">当在<code>Barrier</code>上<code>await</code>的线程数量达到预定的要求后，所有的<code>await</code>的线程不再等待，全部解锁。并且，<code>Barrier</code>将执行预定的回调动作（本程序中，回调动作就是<code>CalculateFinalResult</code>）</div>
        </div>
    </div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">

<span class="kn">import</span> <span class="nn">java.util.concurrent.BrokenBarrierException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CyclicBarrier</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CyclicBarrierExample</span> <span class="o">{</span>
  
  <span class="cm">/**
</span><span class="cm">   * 假定有三行数，用三个线程分别计算每一行的和，最终计算总和
</span><span class="cm">   * @param args
</span><span class="cm">   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span><span class="o">[][]</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">3</span><span class="o">][</span><span class="n">5</span><span class="o">];</span>
    <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">results</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">3</span><span class="o">];</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">row1</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">5</span><span class="o">};</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">row2</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="n">6</span><span class="o">,</span> <span class="n">7</span><span class="o">,</span> <span class="n">8</span><span class="o">,</span> <span class="n">9</span><span class="o">,</span> <span class="n">10</span><span class="o">};</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">row3</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="n">11</span><span class="o">,</span> <span class="n">12</span><span class="o">,</span> <span class="n">13</span><span class="o">,</span> <span class="n">14</span><span class="o">,</span> <span class="n">15</span><span class="o">};</span>
    <span class="n">numbers</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">row1</span><span class="o">;</span>
    <span class="n">numbers</span><span class="o">[</span><span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">row2</span><span class="o">;</span>
    <span class="n">numbers</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">=</span> <span class="n">row3</span><span class="o">;</span>
    
    <span class="n">CalculateFinalResult</span> <span class="n">finalResultCalculator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculateFinalResult</span><span class="o">(</span><span class="n">results</span><span class="o">);</span>
    <span class="n">CyclicBarrier</span> <span class="n">barrier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CyclicBarrier</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">finalResultCalculator</span><span class="o">);</span>
    <span class="c1">//当有3个线程在barrier上await，就执行finalResultCalculator
</span><span class="c1"></span>    
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">CalculateEachRow</span> <span class="n">rowCalculator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculateEachRow</span><span class="o">(</span><span class="n">barrier</span><span class="o">,</span> <span class="n">numbers</span><span class="o">,</span> <span class="n">i</span><span class="o">,</span> <span class="n">results</span><span class="o">);</span>
      <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">rowCalculator</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>   
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CalculateEachRow</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

  <span class="kd">final</span> <span class="kt">int</span><span class="o">[][]</span> <span class="n">numbers</span><span class="o">;</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">rowNumber</span><span class="o">;</span>
  <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">res</span><span class="o">;</span>
  <span class="kd">final</span> <span class="n">CyclicBarrier</span> <span class="n">barrier</span><span class="o">;</span>
  
  <span class="n">CalculateEachRow</span><span class="o">(</span><span class="n">CyclicBarrier</span> <span class="n">barrier</span><span class="o">,</span> <span class="kt">int</span><span class="o">[][]</span> <span class="n">numbers</span><span class="o">,</span> <span class="kt">int</span> <span class="n">rowNumber</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">barrier</span> <span class="o">=</span> <span class="n">barrier</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">numbers</span> <span class="o">=</span> <span class="n">numbers</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rowNumber</span> <span class="o">=</span> <span class="n">rowNumber</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">row</span> <span class="o">=</span> <span class="n">numbers</span><span class="o">[</span><span class="n">rowNumber</span><span class="o">];</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">data</span> <span class="o">:</span> <span class="n">row</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">sum</span> <span class="o">+=</span> <span class="n">data</span><span class="o">;</span>
      <span class="n">res</span><span class="o">[</span><span class="n">rowNumber</span><span class="o">]</span> <span class="o">=</span> <span class="n">sum</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;: 计算第&#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">rowNumber</span> <span class="o">+</span> <span class="n">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;行结束，结果为: &#34;</span> <span class="o">+</span> <span class="n">sum</span><span class="o">);</span>
      <span class="n">barrier</span><span class="o">.</span><span class="na">await</span><span class="o">();</span> <span class="c1">//等待！只要超过3个(Barrier的构造参数)，就放行。
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="o">|</span> <span class="n">BrokenBarrierException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">CalculateFinalResult</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">eachRowRes</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">finalRes</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getFinalResult</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">finalRes</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="n">CalculateFinalResult</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">eachRowRes</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">eachRowRes</span> <span class="o">=</span> <span class="n">eachRowRes</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">data</span> <span class="o">:</span> <span class="n">eachRowRes</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">sum</span> <span class="o">+=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">finalRes</span> <span class="o">=</span> <span class="n">sum</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;最终结果为: &#34;</span> <span class="o">+</span> <span class="n">finalRes</span><span class="o">);</span>
  <span class="o">}</span>
  
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * Thread-0: 计算第1行结束，结果为: 15
</span><span class="cm"> * Thread-2: 计算第3行结束，结果为: 65
</span><span class="cm"> * Thread-1: 计算第2行结束，结果为: 40
</span><span class="cm"> * 最终结果为: 120
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="65-phaser">6.5 <code>Phaser</code></h3>
<ul>
<li>允许执行并发多阶段任务，同步辅助类</li>
<li>在每一个阶段结束的位置对线程进行同步，当所有的线程都到达这步，再进行下一步</li>
<li><code>Phaser</code>
<ul>
<li><code>arrive()</code></li>
<li><code>arriveAndAwaitAdvance()</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">
<span class="kn">import</span> <span class="nn">java.util.concurrent.Phaser</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhaserExample</span> <span class="o">{</span>

  <span class="cm">/**
</span><span class="cm">   * 假设举行考试，总共三道大题，每次下发一道题目，等所有学生完成后再进行下一道
</span><span class="cm">   * 
</span><span class="cm">   * @param args
</span><span class="cm">   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

    <span class="kt">int</span> <span class="n">studentsCnt</span> <span class="o">=</span> <span class="n">5</span><span class="o">;</span>
    <span class="n">Phaser</span> <span class="n">phaser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Phaser</span><span class="o">(</span><span class="n">studentsCnt</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">studentsCnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Student</span><span class="o">(</span><span class="n">phaser</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Student</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Phaser</span> <span class="n">phaser</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Student</span><span class="o">(</span><span class="n">Phaser</span> <span class="n">phaser</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">phaser</span> <span class="o">=</span> <span class="n">phaser</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">doTesting</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
      <span class="n">phaser</span><span class="o">.</span><span class="na">arriveAndAwaitAdvance</span><span class="o">();</span> <span class="c1">//等到5个线程都到了，才放行
</span><span class="c1"></span>      <span class="n">doTesting</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
      <span class="n">phaser</span><span class="o">.</span><span class="na">arriveAndAwaitAdvance</span><span class="o">();</span>
      <span class="n">doTesting</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>
      <span class="n">phaser</span><span class="o">.</span><span class="na">arriveAndAwaitAdvance</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">doTesting</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#34;开始答第&#34;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&#34;题&#34;</span><span class="o">);</span>
    <span class="kt">long</span> <span class="n">thinkingTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">1000</span><span class="o">);</span>
    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">thinkingTime</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#34;第&#34;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&#34;道题答题结束&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * Thread-1开始答第1题
</span><span class="cm"> * Thread-3开始答第1题
</span><span class="cm"> * Thread-2开始答第1题
</span><span class="cm"> * Thread-4开始答第1题
</span><span class="cm"> * Thread-0开始答第1题
</span><span class="cm"> * Thread-4第1道题答题结束
</span><span class="cm"> * Thread-3第1道题答题结束
</span><span class="cm"> * Thread-0第1道题答题结束
</span><span class="cm"> * Thread-2第1道题答题结束
</span><span class="cm"> * Thread-1第1道题答题结束
</span><span class="cm"> * Thread-1开始答第2题
</span><span class="cm"> * Thread-4开始答第2题
</span><span class="cm"> * Thread-3开始答第2题
</span><span class="cm"> * Thread-2开始答第2题
</span><span class="cm"> * Thread-0开始答第2题
</span><span class="cm"> * Thread-2第2道题答题结束
</span><span class="cm"> * Thread-1第2道题答题结束
</span><span class="cm"> * Thread-4第2道题答题结束
</span><span class="cm"> * Thread-0第2道题答题结束
</span><span class="cm"> * Thread-3第2道题答题结束
</span><span class="cm"> * Thread-3开始答第3题
</span><span class="cm"> * Thread-0开始答第3题
</span><span class="cm"> * Thread-4开始答第3题
</span><span class="cm"> * Thread-1开始答第3题
</span><span class="cm"> * Thread-2开始答第3题
</span><span class="cm"> * Thread-0第3道题答题结束
</span><span class="cm"> * Thread-1第3道题答题结束
</span><span class="cm"> * Thread-4第3道题答题结束
</span><span class="cm"> * Thread-2第3道题答题结束
</span><span class="cm"> * Thread-3第3道题答题结束
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="66-exchanger">6.6 <code>Exchanger</code></h3>
<ul>
<li>允许在并发线程中<strong>互相交换消息</strong></li>
<li>允许在2个线程中定义同步点，当两个线程都到达同步点，它们交换数据结构</li>
<li><code>Exchanger</code>
<ul>
<li><code>exchange()</code>, 线程双方互相交互数据</li>
<li>交换数据是双向的</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">

<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Exchanger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExchangerExample</span> <span class="o">{</span>
  
  <span class="cm">/**
</span><span class="cm">   * 本例通过Exchanger实现学生成绩查询，简单线程间数据的交换
</span><span class="cm">   * @param args
</span><span class="cm">   * @throws InterruptedException
</span><span class="cm">   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">Exchanger</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">exchanger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Exchanger</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">BackgroundWorker</span> <span class="n">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BackgroundWorker</span><span class="o">(</span><span class="n">exchanger</span><span class="o">);</span>
    <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">worker</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
    
    <span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
    <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;输入要查询的属性学生姓名：&#34;</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">input</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">nextLine</span><span class="o">().</span><span class="na">trim</span><span class="o">();</span>
      <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">input</span><span class="o">);</span> <span class="c1">//把用户输入传递给线程
</span><span class="c1"></span>      <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span> <span class="c1">//拿到线程反馈结果
</span><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="s">&#34;exit&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;查询结果：&#34;</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">scanner</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span> 
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">BackgroundWorker</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

  <span class="kd">final</span> <span class="n">Exchanger</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">exchanger</span><span class="o">;</span>
  <span class="n">BackgroundWorker</span><span class="o">(</span><span class="n">Exchanger</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">exchanger</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">exchanger</span> <span class="o">=</span> <span class="n">exchanger</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">item</span> <span class="o">=</span> <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">case</span> <span class="s">&#34;zhangsan&#34;</span><span class="o">:</span> 
          <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="s">&#34;90&#34;</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="s">&#34;lisi&#34;</span><span class="o">:</span>
          <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="s">&#34;80&#34;</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="s">&#34;wangwu&#34;</span><span class="o">:</span>
          <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="s">&#34;70&#34;</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="s">&#34;exit&#34;</span><span class="o">:</span>
          <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="s">&#34;exit&#34;</span><span class="o">);</span>
          <span class="k">return</span><span class="o">;</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="s">&#34;查无此人&#34;</span><span class="o">);</span>
        <span class="o">}</span>         
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>       
    <span class="o">}</span>
  <span class="o">}</span>   
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * 输入要查询的属性学生姓名：
</span><span class="cm"> * lisi
</span><span class="cm"> * 查询结果：80
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="7-java定时任务执行">7 Java定时任务执行</h2>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><code>Thread/Executor/Fork-Join</code> 多线程
<ul>
<li>立刻执行</li>
<li>框架调度</li>
</ul>
</li>
<li>定时执行
<ul>
<li>固定某一个时间点运行</li>
<li>以某一个周期</li>
</ul>
</li>
</ul>
</div>
        </div>
    </div>
<h3 id="71-简单定时器机制">7.1 简单定时器机制</h3>
<ul>
<li>设置计划任务，也就是在指定的时间开始执行某一个任务。</li>
<li><code>TimerTask</code> 封装任务</li>
<li><code>Timer</code>类 定时器</li>
</ul>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>笔记<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">一个<code>Timer</code>对象可以执行多个计划任务，但是这些任务是串行执行的。如果有一个任务执行很慢，将会影响后续的任务准点运行。</div>
        </div>
    </div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">timer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimerTest</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
      <span class="n">MyTask</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyTask</span><span class="o">();</span>
      <span class="n">Timer</span> <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">();</span>
      
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;当前时间：&#34;</span><span class="o">+</span><span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">toLocaleString</span><span class="o">());</span>
      <span class="c1">//当前时间1秒后，每2秒执行一次
</span><span class="c1"></span>      <span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task</span><span class="o">,</span> <span class="n">1000</span><span class="o">,</span> <span class="n">2000</span><span class="o">);</span>
      
      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
      <span class="n">task</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>  <span class="c1">//取消当前的任务
</span><span class="c1"></span>      
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;================================&#34;</span><span class="o">);</span>
      
      <span class="n">Calendar</span> <span class="n">now</span> <span class="o">=</span> <span class="n">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
      <span class="n">now</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">Calendar</span><span class="o">.</span><span class="na">SECOND</span><span class="o">,</span><span class="n">now</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Calendar</span><span class="o">.</span><span class="na">SECOND</span><span class="o">)+</span><span class="n">3</span><span class="o">);</span>
      <span class="n">Date</span> <span class="n">runDate</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
      <span class="n">MyTask2</span> <span class="n">task2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyTask2</span><span class="o">();</span>
      <span class="n">timer</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(</span><span class="n">task2</span><span class="o">,</span><span class="n">runDate</span><span class="o">,</span><span class="n">3000</span><span class="o">);</span> <span class="c1">//固定速率
</span><span class="c1"></span>          
      
      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">20000</span><span class="o">);</span>
      <span class="n">timer</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>  <span class="c1">//取消定时器
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MyTask</span> <span class="kd">extends</span> <span class="n">TimerTask</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;运行了！时间为：&#34;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MyTask2</span> <span class="kd">extends</span> <span class="n">TimerTask</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;运行了！时间为：&#34;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">4000</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 当前时间：2022-3-1 1:07:56
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:07:57 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:07:59 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:01 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:03 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:05 CST 2022
</span><span class="cm"> * ================================
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:09 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:13 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:17 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:21 CST 2022
</span><span class="cm"> * 运行了！时间为：Tue Mar 01 01:08:25 CST 2022
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="72-executor-定时器机制">7.2 Executor +定时器机制</h3>
<ul>
<li><code>ScheduledExecutorService</code>
<ul>
<li>定时任务</li>
<li>周期任务</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">schedule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ScheduledExecutorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScheduledExecutorTest</span> <span class="o">{</span>
    
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
    <span class="o">{</span>
      <span class="c1">//executeAtFixTime();
</span><span class="c1"></span>      <span class="c1">//executeFixedRate();  //3s
</span><span class="c1"></span>      <span class="n">executeFixedDelay</span><span class="o">();</span>  <span class="c1">//4s
</span><span class="c1"></span>    <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">executeAtFixTime</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ScheduledExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">MyTask</span><span class="o">(),</span>
                <span class="n">1</span><span class="o">,</span>                
                <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
        
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">20000</span><span class="o">);</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
  
  <span class="cm">/**
</span><span class="cm">     * 周期任务 固定速率 是以上一个任务开始的时间计时，period时间过去后，检测上一个任务是否执行完毕，
</span><span class="cm">     * 如果上一个任务执行完毕，则当前任务立即执行，如果上一个任务没有执行完毕，则需要等上一个任务执行完毕后立即执行。
</span><span class="cm">   * @throws Exception 
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">executeFixedRate</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ScheduledExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">MyTask</span><span class="o">(),</span>
                <span class="n">1</span><span class="o">,</span>
                <span class="n">3000</span><span class="o">,</span>
                <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
        
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">20000</span><span class="o">);</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 周期任务 固定延时 是以上一个任务结束时开始计时，period时间过去后，立即执行。
</span><span class="cm">     * @throws Exception 
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">executeFixedDelay</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ScheduledExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">scheduleWithFixedDelay</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">MyTask</span><span class="o">(),</span>
                <span class="n">1</span><span class="o">,</span>
                <span class="n">3000</span><span class="o">,</span>
                <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
        
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">20000</span><span class="o">);</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>    
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MyTask</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;时间为：&#34;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//System.out.println(&#34;时间为：&#34; + new Date());
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="73-quartz">7.3 Quartz</h3>
<ul>
<li><code>Quartz</code>是一个较为完善的任务调度框架</li>
<li>解决程序中<code>Timer</code>零散管理的问题</li>
<li>功能更加强大
<ul>
<li><code>Timer</code>执行周期任务，如果中间某一次有异常，整个任务终止执行</li>
<li><code>Quartz</code>执行周期任务，如果中间某一次有异常，不影响下次任务执行</li>
<li>……</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="c1">// quartz/QuartzTest.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">quartz</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.quartz.JobDetail</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.quartz.Scheduler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.quartz.Trigger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.quartz.impl.StdSchedulerFactory</span><span class="o">;</span>

<span class="kn">import static</span> <span class="nn">org.quartz.JobBuilder.newJob</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.quartz.SimpleScheduleBuilder.simpleSchedule</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.quartz.TriggerBuilder.newTrigger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuartzTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">//创建scheduler
</span><span class="c1"></span>            <span class="n">Scheduler</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="n">StdSchedulerFactory</span><span class="o">.</span><span class="na">getDefaultScheduler</span><span class="o">();</span>

            <span class="c1">//定义一个Trigger
</span><span class="c1"></span>            <span class="n">Trigger</span> <span class="n">trigger</span> <span class="o">=</span> <span class="n">newTrigger</span><span class="o">().</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">&#34;trigger1&#34;</span><span class="o">,</span> <span class="s">&#34;group1&#34;</span><span class="o">)</span> <span class="c1">//定义name/group
</span><span class="c1"></span>                    <span class="o">.</span><span class="na">startNow</span><span class="o">()</span><span class="c1">//一旦加入scheduler，立即生效
</span><span class="c1"></span>                    <span class="o">.</span><span class="na">withSchedule</span><span class="o">(</span><span class="n">simpleSchedule</span><span class="o">()</span> <span class="c1">//使用SimpleTrigger
</span><span class="c1"></span>                            <span class="o">.</span><span class="na">withIntervalInSeconds</span><span class="o">(</span><span class="n">2</span><span class="o">)</span> <span class="c1">//每隔2秒执行一次
</span><span class="c1"></span>                            <span class="o">.</span><span class="na">repeatForever</span><span class="o">())</span> <span class="c1">//一直执行
</span><span class="c1"></span>                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

            <span class="c1">//定义一个JobDetail
</span><span class="c1"></span>            <span class="n">JobDetail</span> <span class="n">job</span> <span class="o">=</span> <span class="n">newJob</span><span class="o">(</span><span class="n">HelloJob</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">//定义Job类为HelloQuartz类
</span><span class="c1"></span>                    <span class="o">.</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">&#34;job1&#34;</span><span class="o">,</span> <span class="s">&#34;group1&#34;</span><span class="o">)</span> <span class="c1">//定义name/group
</span><span class="c1"></span>                    <span class="o">.</span><span class="na">usingJobData</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;quartz&#34;</span><span class="o">)</span> <span class="c1">//定义属性
</span><span class="c1"></span>                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

            <span class="c1">//加入这个调度
</span><span class="c1"></span>            <span class="n">scheduler</span><span class="o">.</span><span class="na">scheduleJob</span><span class="o">(</span><span class="n">job</span><span class="o">,</span> <span class="n">trigger</span><span class="o">);</span>

            <span class="c1">//启动
</span><span class="c1"></span>            <span class="n">scheduler</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

            <span class="c1">//运行一段时间后关闭
</span><span class="c1"></span>            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
            <span class="n">scheduler</span><span class="o">.</span><span class="na">shutdown</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// quartz/HelloJob.java
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">quartz</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.quartz.Job</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.quartz.JobDetail</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.quartz.JobExecutionContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.quartz.JobExecutionException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloJob</span> <span class="kd">implements</span> <span class="n">Job</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JobExecutionException</span> <span class="o">{</span>
        <span class="n">JobDetail</span> <span class="n">detail</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getJobDetail</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="na">getJobDataMap</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hello from &#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34; at &#34;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * hello from name at Tue Mar 01 01:34:57 CST 2022
</span><span class="cm"> * hello from name at Tue Mar 01 01:34:59 CST 2022
</span><span class="cm"> * hello from name at Tue Mar 01 01:35:01 CST 2022
</span><span class="cm"> * hello from name at Tue Mar 01 01:35:03 CST 2022
</span><span class="cm"> * hello from name at Tue Mar 01 01:35:05 CST 2022
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> */</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-02-22</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://ieblyang.tech/java11/" data-title="[Java核心技术] Java并发编程" data-hashtags="Java,JavaVolume"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://ieblyang.tech/java11/" data-hashtag="Java"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Linkedin" data-sharer="linkedin" data-url="https://ieblyang.tech/java11/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://ieblyang.tech/java11/" data-title="[Java核心技术] Java并发编程" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://ieblyang.tech/java11/" data-title="[Java核心技术] Java并发编程" data-ralateuid="ieblYang"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://ieblyang.tech/java11/" data-title="[Java核心技术] Java并发编程"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/baidu.svg"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://ieblyang.tech/java11/" data-title="[Java核心技术] Java并发编程"><i class="fab fa-evernote fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Skype" data-sharer="skype" data-url="https://ieblyang.tech/java11/" data-title="[Java核心技术] Java并发编程"><i class="fab fa-skype fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/java/">Java</a>,&nbsp;<a href="/tags/javavolume/">《Java 核心技术》</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/java10/" class="prev" rel="prev" title="[Java核心技术] Java多线程"><i class="fas fa-angle-left fa-fw"></i>[Java核心技术] Java多线程</a>
            <a href="/basic-markdown-syntax/" class="next" rel="next" title="Markdown 基本语法">Markdown 基本语法<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">ieblYang</a></span>&nbsp;|&nbsp;<span class="license"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61032202000144">陕公网安备 61032202000144号</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="http://www.beian.miit.gov.cn" target="_blank" rel="nofollow">陕ICP备2021001074号-2</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"kpgPchgfg6K9RMdLzdhxQyOV-gzGzoHsz","appKey":"erpDYbf9JmO61Yn1YtUw7AXB","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"visitor":true}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"2WIOUBN71W","algoliaIndex":"ieblyang","algoliaSearchKey":"f169f964063f4eed7cd46b7826cd7bf0","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.7bc7989e979c4a19d97db3ab311a80fe.js" integrity="md5-e8eYnpecShnZfbOrMRqA/g=="></script></body>
</html>
